
local ADMIN_IDS = {8304907119, 5078078035}

-- // === SERVICES ===
local Players = game:GetService("Players")
local TextChatService = game:GetService("TextChatService")
local LocalPlayer = Players.LocalPlayer

-- // === UTILITIES ===
local PREFIX = "."

local function isAdmin(userId)
    for _, id in ipairs(ADMIN_IDS) do
        if userId == id then return true end
    end
    return false
end

local function getHumanoid(plr)
    local char = plr.Character or plr.CharacterAdded:Wait()
    return char and char:FindFirstChildOfClass("Humanoid")
end

local function getRoot(plr)
    local char = plr.Character or plr.CharacterAdded:Wait()
    return char and char:FindFirstChild("HumanoidRootPart")
end

-- Runs a command on THE PERSON RUNNING THIS SCRIPT (LocalPlayer),
-- but only if the sender is an admin AND not the LocalPlayer.
local function runCommandFrom(senderUserId, rawText)
    if type(rawText) ~= "string" or not isAdmin(senderUserId) then return end
    if senderUserId == LocalPlayer.UserId then return end -- <<< ignore own messages

    local text = rawText:lower():gsub("^%s+", ""):gsub("%s+$", "")
    if not text:find("^" .. PREFIX) then return end

    local space = text:find("%s")
    local cmd = space and text:sub(1, space - 1) or text
    cmd = cmd:sub(#PREFIX + 1)

    local hum = getHumanoid(LocalPlayer)
    local root = getRoot(LocalPlayer)
    if not hum or not root then return end

    if cmd == "sit" then
        hum.Sit = true

    elseif cmd == "jump" then
        hum.Jump = true
        hum:ChangeState(Enum.HumanoidStateType.Jumping)

    elseif cmd == "reset" then
        hum.Health = 0

    elseif cmd == "freeze" then
        local char = LocalPlayer.Character
        if char then
            for _, part in ipairs(char:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.Anchored = true
                end
            end
        end

    elseif cmd == "unfreeze" then
        local char = LocalPlayer.Character
        if char then
            for _, part in ipairs(char:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.Anchored = false
                end
            end
        end

    elseif cmd == "fling" then
        -- Strong shove upward & forward
        local push = Vector3.new(0, 200, 0) + (root.CFrame.LookVector * 200)
        pcall(function() root.AssemblyLinearVelocity = push end)
        root.Velocity = push

    elseif cmd == "bring" then
        local admin = Players:GetPlayerByUserId(senderUserId)
        local adminRoot = admin and getRoot(admin)
        if adminRoot then
            root.CFrame = adminRoot.CFrame + Vector3.new(0, 3, 0)
        end
    end
end

-- // === CHAT LISTENERS (supports BOTH systems) ===
local function hookTextChatService()
    if TextChatService and TextChatService.ChatVersion == Enum.ChatVersion.TextChatService then
        TextChatService.MessageReceived:Connect(function(message)
            local src = message.TextSource
            if src then
                runCommandFrom(src.UserId, message.Text)
            end
        end)
        return true
    end
    return false
end

local function hookLegacyChat()
    if Players.PlayerChatted then
        Players.PlayerChatted:Connect(function(player, message)
            runCommandFrom(player.UserId, message)
        end)
        return true
    end
    return false
end

hookTextChatService()
hookLegacyChat()
